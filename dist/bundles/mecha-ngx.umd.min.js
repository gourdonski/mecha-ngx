!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common/http"),require("immutable"),require("rxjs/AsyncSubject"),require("rxjs/Observable"),require("rxjs/add/observable/interval"),require("rxjs/add/observable/throw"),require("rxjs/add/operator/catch"),require("rxjs/add/operator/debounceTime"),require("rxjs/add/operator/finally"),require("rxjs/add/operator/map"),require("rxjs/add/operator/share"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/take"),require("rxjs/add/operator/takeUntil"),require("molar"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define(["exports","@angular/core","@angular/common/http","immutable","rxjs/AsyncSubject","rxjs/Observable","rxjs/add/observable/interval","rxjs/add/observable/throw","rxjs/add/operator/catch","rxjs/add/operator/debounceTime","rxjs/add/operator/finally","rxjs/add/operator/map","rxjs/add/operator/share","rxjs/add/operator/switchMap","rxjs/add/operator/take","rxjs/add/operator/takeUntil","molar","@angular/platform-browser"],t):t(e["mecha-ngx"]={},e.ng.core,e.ng.common.http,e.immutable,e.Rx,e.Rx,e.Rx.Observable,e.Rx.Observable,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.molar,e.ng.platformBrowser)}(this,function(e,t,r,o,n,s,a,u,i,c,p,h,d,l,b,m,f,g){"use strict";var y=new t.InjectionToken("mechaAppConfig"),q=new t.InjectionToken("mechaCache"),v=function(){return function(e){var t=e.requester,r=e.requestNumber,o=void 0===r?1:r,n=e.lastRequestTimestamp,s=void 0===n?new Date:n,a=e.data;this.requester=t,this.requestNumber=o,this.lastRequestTimestamp=s,this.data=a}}(),_=function(){function e(){}return e.prototype.getHashCode=function(e){if(!("string"==typeof e||e instanceof String))return null;var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t},e}();_.decorators=[{type:t.Injectable}],_.ctorParameters=function(){return[]};var R=function(){function e(e,t,r,o){this._appConfig=e,this._cache=t,this._http=r,this._util=o,this._requestLookup={},this._requesterHistory={},this._isDebouncingRequest=!1}return e.prototype.get=function(e){var t=this;return this._http.get(e)["catch"](this.handleResponseError).map(function(e){return new v({requester:"get",requestNumber:t.getRequestNumber("get"),data:t.getResponseJson(e)})})},e.prototype.getShared=function(e){var t=this,r="getShared";return this._http.get(e)["catch"](this.handleResponseError).map(function(e){return new v({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)})}).share()},e.prototype.getDebounced=function(e,t){var r=this;void 0===t&&(t=1e3);var o="getDebounced";return this._isDebouncingRequest||(this._debouncedSource=new n.AsyncSubject,this._http.get(e).takeUntil(this._debouncedSource).debounceTime(t)["catch"](this.handleResponseError).map(function(e){return new v({requester:o,requestNumber:r.getRequestNumber(o),data:r.getResponseJson(e)})})["finally"](function(){return r._isDebouncingRequest=!1}).subscribe(this._debouncedSource)),this._isDebouncingRequest=!0,this._debouncedSource},e.prototype.getUntil=function(e,t,r,o){var n=this;void 0===r&&(r=1e3);var a="getUntil",u=s.Observable.interval(r).takeUntil(t);return o&&(u=u.take(o)),u.switchMap(function(){return n._http.get(e)})["catch"](this.handleResponseError).map(function(e){return new v({requester:a,requestNumber:n.getRequestNumber(a),data:n.getResponseJson(e)})}).share()},e.prototype.getImmutable=function(e){var t=this,r="getImmutable";return this._http.get(e)["catch"](this.handleResponseError).map(function(e){return o.fromJS(new v({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)}))}).share().map(function(e){return e.toJS()})},e.prototype.getCached=function(e){var t=this,r="getCached",o=this._util.getHashCode(e);return null==this._cache.find(o)&&(this._cache.add(o," "),null!=this._cachedSource&&this._cachedSource.complete(),this._cachedSource=new n.AsyncSubject,this._http.get(e)["catch"](this.handleResponseError).map(function(e){return new v({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)})}).subscribe(this._cachedSource)),this._cachedSource},e.prototype.getCachedImmutable=function(e){var t=this,r="getCachedImmutable",s=this._util.getHashCode("immutable"+e);return null==this._cache.find(s)&&(this._cache.add(s," "),null!=this._cachedImmutableSource&&this._cachedImmutableSource.complete(),this._cachedImmutableSource=new n.AsyncSubject,this._http.get(e)["catch"](this.handleResponseError).map(function(e){return o.fromJS(new v({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)}))}).subscribe(this._cachedImmutableSource)),this._cachedImmutableSource.map(function(e){return e.toJS()})},e.prototype.getRequestNumber=function(e){return++(this._requesterHistory[e]=this._requesterHistory[e]||{requestNumber:0}).requestNumber},e.prototype.getResponseJson=function(e){return e.body},e.prototype.handleResponseError=function(e){var t;if(e instanceof r.HttpResponse){var o=e.body,n=o.error||JSON.stringify(o);t=e.status+(e.statusText?" "+e.statusText:"")+" - "+n}else t=e.message?e.message:e.toString();return s.Observable["throw"](t)},e}();R.decorators=[{type:t.Injectable}],R.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[y]}]},{type:undefined,decorators:[{type:t.Inject,args:[q]}]},{type:r.HttpClient},{type:_}]};var x=function(){function e(e){this._appConfig=e,this._cache=new f.Lookup(!1,e.cacheTtl)}return e.prototype.add=function(e,t){return this._cache.add(e,t)},e.prototype.remove=function(e){return this._cache.remove(e)>0},e.prototype.find=function(e){return this._cache.find(e)[0]},e.prototype.contains=function(e){return this._cache.contains(e)},e.prototype.dump=function(){this._cache.clear()},e.prototype.getCacheTtl=function(){return this._appConfig.cacheTtl},e}();x.decorators=[{type:t.Injectable}],x.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[y]}]}]};var j={cacheTtl:6e4},S=function(){function e(){}return e.forRoot=function(t){var r=t.appConfig,o=void 0===r?j:r,n=t.cacheClass;return{ngModule:e,providers:[{provide:y,useValue:o},{provide:q,useClass:void 0===n?x:n}]}},e}();S.decorators=[{type:t.NgModule,args:[{imports:[g.BrowserModule,r.HttpClientModule],providers:[R]}]}],S.ctorParameters=function(){return[]},e.MechaModule=S,e.ɵc=y,e.ɵe=q,e.ɵa=R,e.ɵf=_,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mecha-ngx.umd.min.js.map
