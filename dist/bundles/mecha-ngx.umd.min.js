!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("molar"),require("@angular/common/http"),require("immutable"),require("rxjs/AsyncSubject"),require("rxjs/Observable"),require("rxjs/add/observable/interval"),require("rxjs/add/observable/throw"),require("rxjs/add/operator/catch"),require("rxjs/add/operator/debounceTime"),require("rxjs/add/operator/finally"),require("rxjs/add/operator/map"),require("rxjs/add/operator/share"),require("rxjs/add/operator/switchMap"),require("rxjs/add/operator/take"),require("rxjs/add/operator/takeUntil"),require("@angular/platform-browser")):"function"==typeof define&&define.amd?define(["exports","@angular/core","molar","@angular/common/http","immutable","rxjs/AsyncSubject","rxjs/Observable","rxjs/add/observable/interval","rxjs/add/observable/throw","rxjs/add/operator/catch","rxjs/add/operator/debounceTime","rxjs/add/operator/finally","rxjs/add/operator/map","rxjs/add/operator/share","rxjs/add/operator/switchMap","rxjs/add/operator/take","rxjs/add/operator/takeUntil","@angular/platform-browser"],t):t(e["mecha-ngx"]={},e.ng.core,e.molar,e.ng.common.http,e.immutable,e.Rx,e.Rx,e.Rx.Observable,e.Rx.Observable,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.Rx.Observable.prototype,e.ng.platformBrowser)}(this,function(e,t,r,o,n,a,s,u,i,c,p,h,d,l,b,f,m,g){"use strict";var y=new t.InjectionToken("mechaAppConfig"),v=new t.InjectionToken("mechaCache"),q=function(){function e(e){this._appConfig=e,this._cache=new r.Lookup(!1,e.cacheTtl)}return e.prototype.add=function(e,t,r){return this._cache.add(e,t,r)},e.prototype.remove=function(e){return this._cache.remove(e)>0},e.prototype.find=function(e){return this._cache.find(e)[0]},e.prototype.contains=function(e){return this._cache.contains(e)},e.prototype.dump=function(){this._cache.clear()},e.prototype.getCacheTtl=function(){return this._appConfig.cacheTtl},e}();q.decorators=[{type:t.Injectable}],q.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[y]}]}]};var x=function(){return function(e){var t=e.requester,r=e.requestNumber,o=void 0===r?1:r,n=e.lastRequestTimestamp,a=void 0===n?new Date:n,s=e.data;this.requester=t,this.requestNumber=o,this.lastRequestTimestamp=a,this.data=s}}(),R=function(){function e(){}return e.prototype.getHashCode=function(e){if(!("string"==typeof e||e instanceof String))return null;var t=0;if(0===e.length)return t;for(var r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t},e}();R.decorators=[{type:t.Injectable}],R.ctorParameters=function(){return[]};var j=function(){function e(e,t,r,o){this._appConfig=e,this._cache=t,this._http=r,this._util=o,this._requesterHistory={},this.formatError=function(e,t,r){return e+(null==t?"":" "+t)+(null==r?"":" - "+r)}}return e.prototype.get=function(e){var t=this;return this._http.get(e)["catch"](this.handleResponseError).map(function(e){return new x({requester:"get",requestNumber:t.getRequestNumber("get"),data:t.getResponseJson(e)})})},e.prototype.getShared=function(e){var t=this,r="getShared";return this._http.get(e)["catch"](this.handleResponseError).map(function(e){return new x({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)})}).share()},e.prototype.getDebounced=function(e,t,r){var o=this;void 0===r&&(r=1e3);var n="getDebounced";return t.debounceTime(r).switchMap(function(){return o._http.get(e)})["catch"](this.handleResponseError).map(function(e){return new x({requester:n,requestNumber:o.getRequestNumber(n),data:o.getResponseJson(e)})}).share()},e.prototype.getUntil=function(e,t,r,o){var n=this;void 0===r&&(r=1e3);var a="getUntil",u=s.Observable.interval(r).takeUntil(t);return null!=o&&(u=u.take(o)),u.switchMap(function(){return n._http.get(e)})["catch"](this.handleResponseError).map(function(e){return new x({requester:a,requestNumber:n.getRequestNumber(a),data:n.getResponseJson(e)})}).share()},e.prototype.getImmutable=function(e){var t=this,r="getImmutable";return this._http.get(e)["catch"](this.handleResponseError).map(function(e){return n.fromJS(new x({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)}))}).share().map(function(e){return e.toJS()})},e.prototype.getCached=function(e){var t=this;try{var r="getCached",o=this._util.getHashCode(e),n=this._cache.find(o);return null==n&&(n=new a.AsyncSubject,this._cache.add(o,n,function(){return n.complete()}),this._http.get(e)["catch"](this.handleResponseError).map(function(e){return new x({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)})}).subscribe(n)),n.asObservable()}catch(u){return s.Observable["throw"](u)}},e.prototype.getCachedImmutable=function(e){var t=this;try{var r="getCachedImmutable",o=this._util.getHashCode("immutable"+e),u=this._cache.find(o);return null==u&&(u=new a.AsyncSubject,this._cache.add(o,u,function(){return u.complete()}),this._http.get(e)["catch"](this.handleResponseError).map(function(e){return n.fromJS(new x({requester:r,requestNumber:t.getRequestNumber(r),data:t.getResponseJson(e)}))}).subscribe(u)),u.map(function(e){return e.toJS()})}catch(i){return s.Observable["throw"](i)}},e.prototype.getRequestNumber=function(e){return++(this._requesterHistory[e]=this._requesterHistory[e]||{requestNumber:0}).requestNumber},e.prototype.getResponseJson=function(e){try{return e.body}catch(t){return t}},e.prototype.handleResponseError=function(e){var t;if(e instanceof o.HttpResponse){var r=e.body,n=r.error||JSON.stringify(r);t=this.formatError(e.status,e.statusText,n)}else t=e.message?e.message:e.toString();return s.Observable["throw"](t)},e}();j.decorators=[{type:t.Injectable}],j.ctorParameters=function(){return[{type:undefined,decorators:[{type:t.Inject,args:[y]}]},{type:undefined,decorators:[{type:t.Inject,args:[v]}]},{type:o.HttpClient},{type:R}]};var _={cacheTtl:6e4},w=function(){function e(){}return e.forRoot=function(t){var r=t.appConfig,o=t.cacheClass;return{ngModule:e,providers:[{provide:y,useValue:r||_},{provide:v,useClass:o||q}]}},e}();w.decorators=[{type:t.NgModule,args:[{imports:[g.BrowserModule,o.HttpClientModule],providers:[q,j,R]}]}],w.ctorParameters=function(){return[]},e.MechaModule=w,e.ɵc=y,e.ɵf=v,e.ɵd=j,e.ɵa=q,e.ɵg=R,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mecha-ngx.umd.min.js.map
